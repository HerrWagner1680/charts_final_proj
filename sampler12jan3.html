<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
<link rel="stylesheet" type="text/css" href="chart.css">
	<title>sampler - a copy of loopy_js.html</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>

<script type="text/javascript">

 google.load("visualization", '1', {packages:['corechart']});
 google.load("visualization", "1.1", {packages:["bar"]});
 google.setOnLoadCallback(drawsamplerChart);

function drawsamplerChart() {
  var query = new google.visualization.Query(
  'https://docs.google.com/spreadsheet/ccc?key=0Atw2BTU52lOCdEZpUlVIdmxGOWZBR2tuLXhYN2dQTWc&usp=drive_web&gid=0#');

  query.send(samplerResponse);
}

function samplerResponse(response) {
  if (response.isError()) {
    alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
    return;
  }

  var data = response.getDataTable();
 
  var options = {
    'title': ($('input[name=chart_title]').val()),
    vAxis: {title: ($('input[name=col_a_label]').val())},
    hAxis: {title: ($('input[name=col_b_label]').val())},
              'width':500,
              'height':400
            };
  var chart = new google.visualization.ColumnChart(document.getElementById('chart_div0'));

    exportCode (data);

    $("#col2").attr('checked', 'checked'); // selecting columnchart radio button for sampler

    //disabling the unrelated radio buttons for sampler
    $("input[class=no_val_val]").attr('disabled', false);
    $("input[class=no_string]").attr('disabled', true);

    chart.draw( data, options);

    //$(document).scrollTop(0); //document scrolls to top of page
}

</script>

<title>Data from a Spreadsheet</title>
</head>

<body>

<!--div that will hold the charts-->
<br>
<div id="chart_div0"></div>
<br>

<button id="refresh">Refresh (redraw chart)</button>
<br>
<br>
<!-- radio buttons -->
  <p id="select_typ">select a type of chart</p>

  <br>

  <input id="area2" class="no_val_val" type="radio" name="chart_type" value="area"><label for="area2">area</label></button>
  <input id="bar2" class="no_val_val" type="radio" name="chart_type" value="bar"><label for="bar2">horizontal bar</label>
  <input id="step2" class="no_val_val" type="radio" name="chart_type" value="step"><label for="step2">step</label>
  <input id="col2" class="no_val_val" type="radio" name="chart_type" value="column"><label for="col2">column</label>
  <input id="line2" class="no_val_val" type="radio" name="chart_type" value="line"><label for="line2">line</label>
  <input id="donut2" class="no_val_val" type="radio" name="chart_type" value="donut"><label for="donut2">pie / donut</label>
  <input id="pie2" class="no_val_val" type="radio" name="chart_type" value="pie"><label for="pie2">pie 3D</label>
  <input id="scatter2" class="no_string" type="radio" name="chart_type" value="scatter"><label for="scatter2">scatter</label>
  <input id="lin2" class="no_string" type="radio" name="chart_type" value="trend_lin"><label for="lin2">trend: linear</label>
  <input id="exp2" class="no_string" type="radio" name="chart_type" value="trend_exp"><label for="exp2">trend: exponential</label>
  <input id="poly2" class="no_string" type="radio" name="chart_type" value="trend_poly"><label for="poly2">trend: polynomial</label>
  <br>
<!-- END OF RADIO BUTTONS -->

<!-- DATA FORM -->
  <p>TITLE OF CHART:  <input type="text" name="chart_title" value="Title"></p>

<table id="real-data">
  <tr>
  <th><input type="text" id="col_a_label" name="col_a_label" value="Axis 1"></th>
  <th><input type="text" id="col_b_label" name="col_b_label" value="Axis 2"></th>
  <th><button id="add_col"> >> </button><th>
  </tr>
  <tr>
    <th>
    <select id="dataType_col_a" name="dataType_col_a" required>
    <option value = ""> - select data type - </option>
    <option value = "string">string</option>
    <option value = "number">number</option>
    </select>
    </th>
    <th>
    <select id="dataType_col_b" name="dataType_col_b" required>
    <option value = "number">number</option>
    <option value = ""> - select data type - </option>
<!--<option value = "string">string</option> -->
    </select>
    </th>
    <th><button id="remove_col"> << </button><th>
  </tr>
  <tr id="row_1">
    <td class="col_a"><input type="text" id="cell_1_a" name="cell_1_a" value=""></td>
    <td class="col_b"><input type="text" id="cell_1_b" name="cell_1_b" value=""></td>
  </tr>
  <tr id="row_2">
    <td class="col_a"><input type="text" id="cell_2_a" name="cell_2_a" value=""></td>
    <td class="col_b"><input type="text" id="cell_2_b" name="cell_2_b" value=""></td>
  </tr>
  <tr id="row_3">
    <td class="col_a"><input type="text" id="cell_3_a" name="cell_3_a" value=""></td>
    <td class="col_b"><input type="text" id="cell_3_b" name="cell_3_b" value=""></td>
  </tr>
  <tr id="row_4">
    <td class="col_a"><input type="text" id="cell_4_a" name="cell_4_a" value=""></td>
    <td class="col_b"><input type="text" id="cell_4_b" name="cell_4_b" value=""></td>
  </tr>
<!-- END OF DATA FORM -->
</table>


<br>
<button id="row_add">ADD ROW</button>
<button id="row_remove">REMOVE ROW</button>
<!-- if you hit max or min - see message -->

<br>
<br>


<h3>UPLOAD GRID DATA FROM GOOGLE SHEET URL</h3>

  <form NAME="myform" onSubmit="JavaScript:ExampleJS()">
  <input  type="url" id="spreadsheet_file" name="spreadsheet_file" size="30">
  <input type="submit" value="Upload URL">
  </form>
<br>
<br>

<!-- export code -->
  <h5>EXPORT CODE</h5>
  <textarea name="export_code" cols=80 rows=25></textarea>
<!-- end of export code -->
<br>
<br>
<button id="export_png">EXPORT TO PNG</button>
<!-- 
<script type="text/javascript" src="draw_new_chart.js"></script>
<script type="text/javascript" src="sampler9jan2.js"></script>
<script type="text/javascript" src="add_rem_col_rows.js"></script> -->

<script>

function stackedCheckbox() {
  $("#select_typ").append("<input id='stack' type='checkbox' name='stacked_column' value='true'></input><label id='stack2'for='stack'>stacked columns</label>");
};

$('#export_png').click(function(){
  alert("NOTE: Export to PNG STILL UNDER CONSTRUCTION")
});


var jUrl = "https://docs.google.com/spreadsheet/ccc?key=0Atw2BTU52lOCdEZpUlVIdmxGOWZBR2tuLXhYN2dQTWc&usp=drive_web&gid=0#";
//perhaps you should only ask for the goog sheet key?
//ignore columns of strings after row a

//https://docs.google.com/spreadsheets/d/15tPYmvsQvHmSdyPp-wzw92lQZdhoM9QGJ-zR-2_k5PA/pubhtml
//https://docs.google.com/spreadsheets/d/15tPYmvsQvHmSdyPp-wzw92lQZdhoM9QGJ-zR-2_k5PA/edit?usp=sharing
//https://docs.google.com/spreadsheet/tq?key=15tPYmvsQvHmSdyPp-wzw92lQZdhoM9QGJ-zR-2_k5PA
//WORKS://https://docs.google.com/spreadsheets/d/15tPYmvsQvHmSdyPp-wzw92lQZdhoM9QGJ-zR-2_k5PA/gviz/tq

// all charts must be public and published to web (have in instructions? or error message?)
  //simple column chart - IT WORKS!
      // https://docs.google.com/spreadsheet/ccc?key=0Atw2BTU52lOCdEZpUlVIdmxGOWZBR2tuLXhYN2dQTWc&usp=drive_web&gid=0#

//metals 
// https://docs.google.com/spreadsheet/ccc?key=0AiFfbdok-kQKcENRYmV0ZC1DcHRIbndKRWZvOHRBTEE#gid=0 //metals

// https://docs.google.com/spreadsheet/tq?key=0AiFfbdok-kQKcENRYmV0ZC1DcHRIbndKRWZvOHRBTEE  //metals 

// https://docs.google.com/spreadsheet/ccc?key=0Atw2BTU52lOCdEZpUlVIdmxGOWZBR2tuLXhYN2dQTWc&usp=drive_web&gid=0#   

//gathering data from upload url window
function handleQueryResponse(response) {
  if (response.isError()) {
    alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
    return;
  }


  var data = response.getDataTable();

  //importing data from URL UPLOAD
    $("#real-data #dataType_col_a").val(data.Pf[0].type) // string or number
    $("#real-data #dataType_col_b").val(data.Pf[1].type)

    // while(current_col_int <= last_col_int){
    // }

    $("#real-data #col_a_label").attr("value", data.Pf[0].label) // column name
    $("#real-data #col_b_label").attr("value", data.Pf[1].label)
  //     console.log(data.Nf[1].c[0].v)
  //     console.log(data.Nf[1].c[1].v)


    var last_row = parseInt($('tr:last-of-type > td:last-of-type > input').attr('id').split('_')[1]);
    // var nf_num = last_row -1;
    for(var i=1;i<=last_row;i++) {
        $("#real-data #cell_" + i + "_a").attr("value", data.Nf[i-1].c[0].v) //first column
        $("#real-data #cell_" + i + "_b").attr("value", data.Nf[i-1].c[1].v) //second column
    }

    // console.log("line 251 HTML...last_row data: " + last_row);
  // //need to have ? true or if else in case object null,nil
}


function SheetRefresh() { 
	console.log("showing jUrl: " + jUrl);

  var query = new google.visualization.Query(jUrl);
  query.send(handleQueryResponse);

}

function ExampleJS(){
	event.preventDefault();
	jUrl = document.getElementById("spreadsheet_file").value;
    console.log("Grabbing File")
    console.log(jUrl);

    $('#spreadsheet_file').val(null) //clears the upload url window
    SheetRefresh();
 }

SheetRefresh();


</script>


<script type="text/javascript" src="draw_new_chart.js"></script>
<script type="text/javascript" src="sampler9jan2.js"></script>
<script type="text/javascript" src="add_rem_col_rows.js"></script>

</body>
</html>