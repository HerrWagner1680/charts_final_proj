<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
<link rel="stylesheet" type="text/css" href="chart.css">
	<title>sampler - a copy of loopy_js.html</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>

<script type="text/javascript">

 google.load("visualization", '1', {packages:['corechart']});
 google.load("visualization", "1.1", {packages:["bar"]});
 google.setOnLoadCallback(drawsamplerChart);


function drawsamplerChart() {
  var query = new google.visualization.Query(
  'https://docs.google.com/spreadsheet/ccc?key=0Atw2BTU52lOCdEZpUlVIdmxGOWZBR2tuLXhYN2dQTWc&usp=drive_web&gid=0#');

  query.send(samplerResponse);
}

function samplerResponse(response) {
    if (response.isError()) {
      alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
      return;
    }

    var data = response.getDataTable();

    console.log("column a direct" + data.Pf[0].label)

    var options = {
      'title': ($('input[name=chart_title]').val()),
      vAxis: {title: (data.Pf[0].label)},
      hAxis: {title: (data.Pf[1].label)},
                'width':500,
                'height':400
              };
    var chart = new google.visualization.ColumnChart(document.getElementById('chart_div0'));

    //set default width and height
    $("#width_chart").val(500)
    $("#height_chart").val(400)

    // exportCode (data);

    $("#col2").attr('checked', 'checked'); // selecting columnchart radio button for sampler

    //disabling the unrelated radio buttons for sampler
    $("input[class=no_val_val]").attr('disabled', false);
    $("input[class=no_string]").attr('disabled', true);

    chart.draw(data, options);

    //$(document).scrollTop(0); //document scrolls to top of page
}

</script>

<title>Data from a Spreadsheet</title>
</head>

<body>

<!--div that will hold the charts-->
<br>
<div id="chart_div0"></div>
<br>

<button id="refresh">Refresh (redraw chart)</button>
<br>
<br>
<br>
    <select id="width_chart" name="width_chart" required>
    <option value = "100">width - 100px</option>
    <option value = "200">width - 200px</option>
    <option value = "300">width - 300px</option>
    <option value = "400">width - 400px</option>
    <option value = "500">width - 500px</option> <!--THIS SHOULD BE DEFAULT-->
    <option value = "600">width - 600px</option>
    <option value = "700">width - 700px</option>
    <option value = "800">width - 800px</option>
    <option value = "900">width - 900px</option>
    <option value = "1000">width - 1000px</option>
    <option value = "1100">width - 1100px</option>
    </select>

    <select id="height_chart" name="height_chart" required>
    <option value = "100">height - 100px</option>
    <option value = "200">height - 200px</option>
    <option value = "300">height - 300px</option>
    <option value = "400">height - 400px</option> <!--THIS SHOULD BE DEFAULT-->
    <option value = "500">height - 500px</option>
    <option value = "600">height - 600px</option>
    <option value = "700">height - 700px</option>
    <option value = "800">height - 800px</option>
    <option value = "900">height - 900px</option>
    </select>
<br>
<!-- radio buttons -->
  <p id="select_typ">select a type of chart</p>

  <br>

  <input id="area2" class="no_val_val" type="radio" name="chart_type" value="area"><label for="area2">area</label></button>
  <input id="bar2" class="no_val_val" type="radio" name="chart_type" value="bar"><label for="bar2">horizontal bar</label>
  <input id="step2" class="no_val_val" type="radio" name="chart_type" value="step"><label for="step2">step</label>
  <input id="col2" class="no_val_val" type="radio" name="chart_type" value="column"><label for="col2">column</label>
  <input id="line2" class="no_val_val" type="radio" name="chart_type" value="line"><label for="line2">line</label>
  <input id="donut2" class="no_val_val" type="radio" name="chart_type" value="donut"><label for="donut2">pie / donut</label>
  <input id="pie2" class="no_val_val" type="radio" name="chart_type" value="pie"><label for="pie2">pie 3D</label>
  <input id="scatter2" class="no_string" type="radio" name="chart_type" value="scatter"><label for="scatter2">scatter</label>
  <input id="lin2" class="no_string" type="radio" name="chart_type" value="trend_lin"><label for="lin2">trend: linear</label>
  <input id="exp2" class="no_string" type="radio" name="chart_type" value="trend_exp"><label for="exp2">trend: exponential</label>
  <input id="poly2" class="no_string" type="radio" name="chart_type" value="trend_poly"><label for="poly2">trend: polynomial</label>
  <br>
<!-- END OF RADIO BUTTONS -->

<!-- DATA FORM -->
  <p>TITLE OF CHART:  <input type="text" name="chart_title" value="Title"></p>

<table id="real-data">
  <tr id="labels">
  <th><input type="text" id="col_a_label" name="col_a_label" value="Axis 1"></th>
  <th><input type="text" id="col_b_label" name="col_b_label" value="Axis 2"></th>
<!--   <th><button id="add_col">&gt;&gt;</button></th> -->
  </tr>
  <tr id="data_types">
    <th>
    <select id="dataType_col_a" name="dataType_col_a" required>
    <option value = ""> - select data type - </option>
    <option value = "string">string</option>
    <option value = "number">number</option>
    </select>
    </th>
    <th>
    <select id="dataType_col_b" name="dataType_col_b" required>
    <option value = "number">number</option>
    <option value = ""> - select data type - </option>
<!--<option value = "string">string</option> -->
    </select>
    </th>
 <!--    <th><button id="remove_col">&lt;&lt;</button></th> -->
  </tr>
  <tr id="row_1">
    <td class="col_a"><input type="text" id="cell_1_a" name="cell_1_a" value=""></td>
    <td class="col_b"><input type="text" id="cell_1_b" name="cell_1_b" value=""></td>
  </tr>
  <tr id="row_2">
    <td class="col_a"><input type="text" id="cell_2_a" name="cell_2_a" value=""></td>
    <td class="col_b"><input type="text" id="cell_2_b" name="cell_2_b" value=""></td>
  </tr>
  <tr id="row_3">
    <td class="col_a"><input type="text" id="cell_3_a" name="cell_3_a" value=""></td>
    <td class="col_b"><input type="text" id="cell_3_b" name="cell_3_b" value=""></td>
  </tr>
  <tr id="row_4">
    <td class="col_a"><input type="text" id="cell_4_a" name="cell_4_a" value=""></td>
    <td class="col_b"><input type="text" id="cell_4_b" name="cell_4_b" value=""></td>
  </tr>
<!-- END OF DATA FORM -->
</table>


<br>
<button id="row_add">ADD ROW</button>
<button id="row_remove">REMOVE ROW</button>
<!-- if you hit max or min - see message -->
<button id="remove_col">&lt;&lt; remove column</button>
<button id="add_col">add column &gt;&gt; </button>
<br>
<br>


<h3>UPLOAD GRID DATA FROM GOOGLE SHEET URL</h3>

  <form NAME="myform" onSubmit="JavaScript:ExampleJS()">
  <input  type="url" id="spreadsheet_file" name="spreadsheet_file" size="30">
  <input type="submit" value="Upload URL">
  </form>
<br>
<br>

<!-- export code -->
  <h5>EXPORT CODE</h5>
  <textarea name="export_code" cols=80 rows=25></textarea>
<!-- end of export code -->
<br>
<br>
<button id="export_png">EXPORT TO PNG</button>
<!-- 
<script type="text/javascript" src="draw_new_chart.js"></script>
<script type="text/javascript" src="sampler9jan2.js"></script>
<script type="text/javascript" src="add_rem_col_rows.js"></script> -->

<script>
function stackedCheckboxAppears() {
  $("#height_chart").after("<input id='stack' type='checkbox' name='stacked_column' value='true'></input><label id='stack2'for='stack'>stacked columns</label>");

  $("#stack, #stack2").bind('click', function(){
    console.log("stackclick");
    // drawChartTest();
    //note - i did try reviseColumn() - but said it was undefined
  });

};



// function stackedCheckboxAppears() {
//   $("#height_chart").after("<input id='stack' type='checkbox' name='stacked_column' value='true'></input><label id='stack2'for='stack'>stacked columns</label>");
// };

$('#export_png').click(function(){
  alert("NOTE: Export to PNG STILL UNDER CONSTRUCTION")
});


var jUrl = "https://docs.google.com/spreadsheet/ccc?key=0Atw2BTU52lOCdEZpUlVIdmxGOWZBR2tuLXhYN2dQTWc&usp=drive_web&gid=0#";
//perhaps you should only ask for the goog sheet key?
//ignore columns of strings after row a

//https://docs.google.com/spreadsheets/d/15tPYmvsQvHmSdyPp-wzw92lQZdhoM9QGJ-zR-2_k5PA/pubhtml
//https://docs.google.com/spreadsheets/d/15tPYmvsQvHmSdyPp-wzw92lQZdhoM9QGJ-zR-2_k5PA/edit?usp=sharing
//https://docs.google.com/spreadsheet/tq?key=15tPYmvsQvHmSdyPp-wzw92lQZdhoM9QGJ-zR-2_k5PA
//WORKS://https://docs.google.com/spreadsheets/d/15tPYmvsQvHmSdyPp-wzw92lQZdhoM9QGJ-zR-2_k5PA/gviz/tq

// all charts must be public and published to web (have in instructions? or error message?)
  //simple column chart - IT WORKS!
      // https://docs.google.com/spreadsheet/ccc?key=0Atw2BTU52lOCdEZpUlVIdmxGOWZBR2tuLXhYN2dQTWc&usp=drive_web&gid=0#

//metals 
// https://docs.google.com/spreadsheet/ccc?key=0AiFfbdok-kQKcENRYmV0ZC1DcHRIbndKRWZvOHRBTEE#gid=0 //metals

// https://docs.google.com/spreadsheet/tq?key=0AiFfbdok-kQKcENRYmV0ZC1DcHRIbndKRWZvOHRBTEE  //metals 

// https://docs.google.com/spreadsheet/ccc?key=0Atw2BTU52lOCdEZpUlVIdmxGOWZBR2tuLXhYN2dQTWc&usp=drive_web&gid=0#   

//sample multi-column URL
// https://docs.google.com/spreadsheets/d/1Hy-c2tyBHP_JLxsHl6hH-acd-eZgl8pGCQOT12rLPJc/edit#gid=0

//gathering data from upload url window
function handleQueryResponse(response) {
  if (response.isError()) {
    alert('Error in query: ' + response.getMessage() + ' ' + response.getDetailedMessage());
    return;
  }


  var data = response.getDataTable();


    var last_row = parseInt($('#real-data tr:last-of-type').attr('id').split('_')[1]);
    var last_col = $('#real-data tr:last-of-type > td:last-of-type > input').attr('id').split('_')[2];
    var last_col_int = last_col.charCodeAt(0);
    var next_col_int = last_col_int + 1;
    var next_col = String.fromCharCode(next_col_int);
    var next_row = last_row + 1;
    var col_a_int = 97;

console.log("line 251: " + ($("#real-data #dataType_col_a").val()));
  //importing data from URL UPLOAD
        //defaults col a to string
    // $("#real-data #dataType_col_a").attr("value", "string");
 //    $('#real-data #data_types #dataType_col_a').attr("value", data.Pf[0].type) // string or number


    $("#dataType_col_a").val(data.Pf[0].type)
// $("#dataType_col_b").val(data.Pf[0].type)

// console.log($("#dataType_col_a").val(data.Pf[0].type))

// console.log($('#real-data #data_types #dataType_col_a').attr("value"));
  //ASSIGN rest of column types as number
  var pf_num = 1
  while(col_a_int +1 <= last_col_int){
      var col_letter = String.fromCharCode(col_a_int);
      // $("#real-data #dataType_col_" + col_letter).val(data.Pf[pf_num].type)
      //defaults col b onward to number
      $("#real-data #data_types #dataType_col_" + col_letter).attr("value", "number");
      col_a_int++;
      pf_num++;
  };

    //resetting variables
    var pf_num = 0
    var col_a_int = 97;
    //ASSIGN column label names
    while(col_a_int <= last_col_int){
        var col_letter = String.fromCharCode(col_a_int);
        $("#real-data #col_" + col_letter + "_label").attr("value", data.Pf[pf_num].label)
        col_a_int++;
        pf_num++;
    };

    var last_row = parseInt($('#real-data tr:last-of-type').attr('id').split('_')[1]);

    // var c_num = 0
    var col_a_int = 97; //reset var
    while(col_a_int <= last_col_int){
        var col_letter = String.fromCharCode(col_a_int);
        var c_num = col_a_int -97;
        // $("#real-data #cell_4_"+col_letter).attr("value",data.Nf[0].c[0].v)
        // $("#real-data #cell_4_"+col_letter).attr("value",data.Nf[1].c[1].v)
        // $("#real-data #cell_3_"+col_letter).attr("value",data.Nf[2].c[0].v)
        // $("#real-data #cell_3_"+col_letter).attr("value",data.Nf[3].c[1].v)
            for(var i=1;i<=last_row;i++) {
                $("#real-data #cell_" + i + "_" + col_letter).attr("value", data.Nf[i-1].c[c_num].v);
                //getting data for each cell
                console.log($("#real-data #cell_" + i + "_" + col_letter).val());
            };

        col_a_int++;
        
    };

}


function SheetRefresh() { 
	console.log("showing jUrl: " + jUrl);

  var query = new google.visualization.Query(jUrl);
  query.send(handleQueryResponse);

}

function ExampleJS(){
	event.preventDefault();
	jUrl = document.getElementById("spreadsheet_file").value;
    console.log("Grabbing File")
    console.log(jUrl);

    $('#spreadsheet_file').val(null) //clears the upload url window
    SheetRefresh();
 }

SheetRefresh();


</script>


<script type="text/javascript" src="draw_new_chart.js"></script>
<script type="text/javascript" src="sampler9jan2.js"></script>
<script type="text/javascript" src="add_rem_col_rows.js"></script>

</body>
</html>